title = "historial de pagos"
url = "/historial_pagos"
layout = "default"
is_hidden = 0

[session]
security = "user"
allowedUserGroups[] = "administrador"
allowedUserGroups[] = "normal"
allowedUserGroups[] = "supervisor"
redirect = "iniciar-sesion"
==
<?php
function onStart(){
    $this['historial']=new class {
        public function his(){
            
            $conectar= mysqli_connect('localhost','root','','clubdeleonesdedavid');
            $sql= "select email from users where `last_login`=(select max(`last_login`)from users)";
            $ejecutar = mysqli_query($conectar,$sql);
            $email = mysqli_fetch_array($ejecutar);
            $email2=$email['email'];
           
            $sql1= "select `cedula` from club_usuarioleon where id_correoleon='$email2'";
            $ejecutar2 = mysqli_query($conectar,$sql1);
            $ced = mysqli_fetch_array($ejecutar2);
            $cedula=$ced['cedula'];   
            
            $data= Db::select('select codigo_de_pago, categoria, descripcion, monto from club_historial_de_pagos INNER JOIN club_tiposdepagos ON club_historial_de_pagos.codigo_de_pago = club_tiposdepagos.codigo_pago where cedula_leon=?', [$cedula]);
            foreach($data as $data1) 
            {echo "<tr>";
                foreach($data1 as $data2)
                    { 
                        echo "<td>$data2</td>";
                    }
            echo "</tr>";
            }
            
        }
         
           
                  
                            };
                                }

 

function onBuscar(){
    $id=$_POST['caja_busqueda'];
    
    $data = Db::select('SELECT codigo_de_pago, categoria, descripcion, saldo FROM historial_de_pagos WHERE codigo_de_pago LIKE :id OR categoria LIKE :id OR descripcion LIKE :id OR saldo LIKE :id', ['id' => $id]);
    foreach($data as $data1) 
                {echo "<tr>";
                    foreach($data1 as $data2)
                        { echo "<td>$data2</td>";
                        }
                echo "</tr>";
                }
    }
?>
==
{% component 'session' %}
{% put scripts %}
    <script src="{{ [
        'assets/javascript/pages/ui-elements.js',
    ]|theme }}"></script>
{% endput %}
{%put scripts%}
<script language="javascript">
        function doSearch()
        {
            const tableReg = document.getElementById('datos');
            const searchText = document.getElementById('searchTerm').value.toLowerCase();
            let total = 0;
 
            // Recorremos todas las filas con contenido de la tabla
            for (let i = 1; i < tableReg.rows.length; i++) {
                // Si el td tiene la clase "noSearch" no se busca en su cntenido
                if (tableReg.rows[i].classList.contains("noSearch")) {
                    continue;
                }
 
                let found = false;
                const cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
                // Recorremos todas las celdas
                for (let j = 0; j < cellsOfRow.length && !found; j++) {
                    const compareWith = cellsOfRow[j].innerHTML.toLowerCase();
                    // Buscamos el texto en el contenido de la celda
                    if (searchText.length == 0 || compareWith.indexOf(searchText) > -1) {
                        found = true;
                        total++;
                    }
                }
                if (found) {
                    tableReg.rows[i].style.display = '';
                } else {
                    // si no ha encontrado ninguna coincidencia, esconde la
                    // fila de la tabla
                    tableReg.rows[i].style.display = 'none';
                }
            }
 
            // mostramos las coincidencias
            const lastTR=tableReg.rows[tableReg.rows.length-1];
            const td=lastTR.querySelector("td");
            lastTR.classList.remove("hide", "red");
            if (searchText == "") {
                lastTR.classList.add("hide");
            } else if (total) {
                td.innerHTML="Se ha encontrado "+total+" coincidencia"+((total>1)?"s":"");
            } else {
                lastTR.classList.add("red");
                td.innerHTML="No se han encontrado coincidencias";
            }
        }
    </script>
{%endput%}
<style type="text/css">
      table {
      border-collapse: collapse;
      border-spacing: 0;
      width: 100%;
      border: 1px solid #ddd;
    }
    
    th, td {
      text-align: left;
      padding: 8px;
    }
    
    tr:nth-child(even){background-color: #f2f2f2}
    #line{
      display: inline;
		}
</style>

<section id="layout-title">
    <div class="container">
      <h3 style="text-align: center">Historial de pagos</h3>
    </div>
</section>

<form>
        <div class="col-sm-3">
            <input placeholder="Buscar" class="form-control"  id="searchTerm" type="text" onkeyup="doSearch()" />
        </div>
</form>
<p>&nbsp;</p>
<p>&nbsp;</p>

<div style="overflow-x:auto;">
  <table id="datos">
        <tr>
            <th>Codigo de pago</th>
            <th>Categoria</th>
            <th>Descripcion</th>
            <th>Monto</th>
        </tr>
        {{historial.his}}
         <tr class='noSearch hide'>
                <td colspan="5"></td>
        </tr>
</table>
</div>
<p>&nbsp;</p><p>&nbsp;</p>